<!DOCTYPE html>
<html>
<head>
    <title>01</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
</head>
<body style='margin : 0px; overflow: hidden;'>
    <a-scene embedded arjs='sourceType: webcam;'>
        <!-- 3D戒指模型 -->
        <a-entity id="ring" gltf-model="url(assets/ring.glb)" position="0 0 -5" animation-mixer></a-entity>
        <!-- 使用MediaPipe的手部追踪數據來定位戒指 -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        const videoElement = document.createElement('video');
        const canvasElement = document.createElement('canvas');
        const canvasCtx = canvasElement.getContext('2d');

        // MediaPipe Hands model
        const hands = new Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
        });

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        // Connect the camera to the video element and start the model
        const camera = new Camera(videoElement, {
            onFrame: async () => {
                await hands.send({image: videoElement});
            },
            width: 1280,
            height: 720
        });
        camera.start();

        // Listen for model results
        hands.onResults((results) => {
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            if (results.multiHandLandmarks) {
                for (const landmarks of results.multiHandLandmarks) {
                    const middleFingerTip = landmarks[12]; // Index of the middle finger tip
                    const x = middleFingerTip.x * -2 + 1; // Adjusting scale and orientation
                    const y = middleFingerTip.y * -2 + 1; // Adjusting scale and orientation
                    const ringEntity = document.querySelector('#ring');
                    if (ringEntity) {
                        ringEntity.object3D.position.set(x, y, -5); // Update the position based on the middle finger
                    }
                }
            }
            canvasCtx.restore();
        });

    </script>
</body>
</html>
