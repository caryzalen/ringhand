<!DOCTYPE html>
<html>
<head>
  <title>WebAR Hand Tracking with MediaPipe</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
  <a-scene>
    <a-entity camera look-controls wasd-controls></a-entity>
    <a-entity id="hand-tracking" position="0 0 -5"></a-entity>
  </a-scene>

  <video id="input_video" style="display:none;"></video>

  <script>
    const videoElement = document.getElementById('input_video');
    const handTrackingEntity = document.getElementById('hand-tracking');

    const hands = new Hands({
      locateFile: (file) => {
        return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
      }
    });

    hands.setOptions({
      maxNumHands: 2,
      modelComplexity: 1,
      minDetectionConfidence: 0.5,
      minTrackingConfidence: 0.5
    });

    hands.onResults(onResults);

    const camera = new Camera(videoElement, {
      onFrame: async () => {
        await hands.send({image: videoElement});
      },
      width: 1280,
      height: 720
    });
    camera.start();

    function onResults(results) {
      handTrackingEntity.innerHTML = ''; // Clear previous points
      if (results.multiHandLandmarks && results.multiHandedness) {
        for (let landmarks of results.multiHandLandmarks) {
          for (let point of landmarks) {
            const x = point.x * 2 - 1; // Convert to AR.js coordinate system
            const y = -point.y * 2 + 1;
            const z = -point.z * 2;

            const sphere = document.createElement('a-sphere');
            sphere.setAttribute('radius', '0.01');
            sphere.setAttribute('color', 'green');
            sphere.setAttribute('position', `${x} ${y} ${z}`);
            handTrackingEntity.appendChild(sphere);
          }
        }
      }
    }
  </script>
</body>
</html>
