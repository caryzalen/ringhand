<!DOCTYPE html>
<html>
  <head>
    <title>Web AR Hand Tracking</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
  </head>
  <body>
    <a-scene>
      <a-entity camera></a-entity>
      <a-entity id="ring" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03" material="color: gold;"></a-entity>
    </a-scene>
    <video id="input_video" style="display:none;"></video>
    <canvas id="output_canvas" style="display:none;"></canvas>
    <script>
      const videoElement = document.getElementById('input_video');
      const canvasElement = document.getElementById('output_canvas');
      const canvasCtx = canvasElement.getContext('2d');

      const hands = new Hands({
        locateFile: (file) => {
          return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
        }
      });

      hands.setOptions({
        maxNumHands: 1,
        modelComplexity: 1,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5
      });

      hands.onResults(onResults);

      const camera = new Camera(videoElement, {
        onFrame: async () => {
          await hands.send({image: videoElement});
        },
        width: 640,
        height: 480
      });
      camera.start();

      function onResults(results) {
        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
          const landmarks = results.multiHandLandmarks[0];

          // 获取中指根部的坐标（其他手指的关节点也可以使用）
          const ringFingerBase = landmarks[9];

          // 将2D坐标转换为3D坐标，这里假设手部追踪是在640x480的画布上
          const x = (ringFingerBase.x - 0.5) * 2;
          const y = (ringFingerBase.y - 0.5) * -2;
          const z = ringFingerBase.z * -2;

          // 调整A-Frame中戒指的位置
          const ringEntity = document.getElementById('ring');
          ringEntity.setAttribute('position', {x: x, y: y, z: z});
        }
      }
    </script>
  </body>
</html>
