<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>01</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  </head>
  <body>
    <a-scene>
      <a-entity camera></a-entity>
      <a-entity id="ring" geometry="primitive: ring; radiusOuter: 0.05; radiusInner: 0.03" material="color: red"></a-entity>
    </a-scene>
    <script>
      const videoElement = document.createElement('video');
      document.body.appendChild(videoElement);
      videoElement.style.display = 'none';

      const hands = new Hands({
        locateFile: (file) => {
          return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
        },
      });
      hands.setOptions({
        maxNumHands: 1,
        modelComplexity: 1,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5,
      });

      const camera = new Camera(videoElement, {
        onFrame: async () => {
          await hands.send({ image: videoElement });
        },
        width: 640,
        height: 480,
      });
      camera.start();

      hands.onResults((results) => {
        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
          const landmarks = results.multiHandLandmarks[0];
          const middleFinger = landmarks.slice(9, 13);

          const ringEntity = document.getElementById('ring');
          const normalizedLandmark = middleFinger[0];
          const x = (normalizedLandmark.x - 0.5) * 2;
          const y = (normalizedLandmark.y - 0.5) * -2;
          const z = -normalizedLandmark.z * 2;

          ringEntity.setAttribute('position', { x, y, z });

          const scene = document.querySelector('a-scene');
          const existingPoints = scene.querySelectorAll('.point');
          existingPoints.forEach((point) => point.parentNode.removeChild(point));

          for (let landmark of landmarks) {
            const point = document.createElement('a-sphere');
            point.setAttribute('radius', '0.01');
            point.setAttribute('color', 'green');
            point.setAttribute('class', 'point');
            const px = (landmark.x - 0.5) * 2;
            const py = (landmark.y - 0.5) * -2;
            const pz = -landmark.z * 2;
            point.setAttribute('position', { x: px, y: py, z: pz });
            scene.appendChild(point);
          }
        }
      });
    </script>
  </body>
</html>
