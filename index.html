<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web AR Hand Tracking with 3D Ring Model</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body>
    <a-scene embedded arjs='sourceType: webcam; debugUIEnabled: false;'>
        <a-assets>
            <a-asset-item id="ring-model" src="assets/ring.glb"></a-asset-item>
        </a-assets>
        <a-entity camera></a-entity>
        <a-entity id="ring" gltf-model="#ring-model" position="0 0 -1" scale="0.02 0.02 0.02"></a-entity>
    </a-scene>
    <canvas id="outputCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const videoElement = document.createElement('video');
            videoElement.setAttribute('autoplay', true);
            videoElement.setAttribute('muted', true);
            videoElement.setAttribute('playsinline', true);
            
            const canvasElement = document.getElementById('outputCanvas');
            const canvasCtx = canvasElement.getContext('2d');
            canvasElement.width = window.innerWidth;
            canvasElement.height = window.innerHeight;

            const hands = new Hands({
                locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
            });

            hands.setOptions({
                maxNumHands: 1,
                modelComplexity: 1,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });

            hands.onResults(results => {
                canvasCtx.save();
                canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
                canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

                if (results.multiHandLandmarks) {
                    for (const landmarks of results.multiHandLandmarks) {
                        const middleFingerTip = landmarks[12]; // Assuming landmark 12 is the tip of the middle finger
                        
                        // 计算在A-Frame中的位置
                        const x = (middleFingerTip.x - 0.5) * 2; // 从0-1范围转换到-1到1
                        const y = (middleFingerTip.y - 0.5) * -2; // 从0-1范围转换到-1到1，并反转y轴
                        const z = -1; // 根据实际情况调整Z坐标

                        const ring = document.getElementById('ring');
                        ring.setAttribute('position', `${x} ${y} ${z}`);
                    }
                }
                canvasCtx.restore();
            });

            const camera = new Camera(videoElement, {
                onFrame: async () => {
                    await hands.send({image: videoElement});
                },
                width: 1280,
                height: 720
            });
            camera.start();
        });
    </script>
</body>
</html>
