<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Ring Try-On</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands"></script>
</head>
<body style='margin: 0; overflow: hidden;'>
  <a-scene embedded arjs>
    <a-marker-camera preset="hiro"></a-marker-camera>
    <a-entity id="ring" geometry="primitive: ring; radiusInner: 0.1; radiusOuter: 0.15" material="color: gold"></a-entity>
  </a-scene>

  <script>
    const hands = new Hands({locateFile: (file) => {
      return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
    }});

    hands.setOptions({
      maxNumHands: 1,
      modelComplexity: 1,
      minDetectionConfidence: 0.5,
      minTrackingConfidence: 0.5
    });

    hands.onResults(onResults);

    const videoElement = document.createElement('video');
    videoElement.width = 640;
    videoElement.height = 480;
    videoElement.autoplay = true;

    navigator.mediaDevices.getUserMedia({video: true})
      .then((stream) => {
        videoElement.srcObject = stream;
        videoElement.play();
      });

    function onResults(results) {
      if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
        const landmarks = results.multiHandLandmarks[0];
        const ringEntity = document.querySelector('#ring');
        const x = (landmarks[9].x - 0.5) * 4;
        const y = (landmarks[9].y - 0.5) * -4;
        ringEntity.setAttribute('position', `${x} ${y} -2`);
      }
    }

    function processVideoFrame() {
      hands.send({image: videoElement});
      requestAnimationFrame(processVideoFrame);
    }

    processVideoFrame();
  </script>
</body>
</html>
